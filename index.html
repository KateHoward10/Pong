<!DOCTYPE html>
<html>
	<head>
		<title>Pong!</title>
	</head>
	<body>
		<svg id="game" width="800" height="600">
			<rect id="player1" width="10" height="50" x="20" y="275" />
			<rect id="ball" width="10" height="10" x="395" y="295" />
			<rect id="player2" width="10" height="50" x="770" y="275" />
		</svg>
		<div>
			<p>My score: <span id="myScore">0</span></p>
			<p>Computerâ€™s score: <span id="computerScore">0</span></p>
		</div>
		<script type="text/javascript">
			const game = document.getElementById('game');
			const player1 = document.getElementById('player1');
			const ball = document.getElementById('ball');
			const player2 = document.getElementById('player2');
			const myScoreBox = document.getElementById('myScore');
			const computerScoreBox = document.getElementById('computerScore');

			let myScore = 0;
			let computerScore = 0;

			setMyScore(0);
			setComputerScore(0);

			function setMyScore(score) {
				myScore = score;
				myScoreBox.textContent = myScore;
			}

			function setComputerScore(score) {
				computerScore = score
				computerScoreBox.textContent = computerScore;
			}

			function movePlayer1() {
				const player1Y = +player1.getAttribute('y');
				player1.setAttribute('y', Math.random() > 0.5 ? player1Y + 20 : player1Y - 20);
			}
			function movePlayer2(event) {
				if (event.keyCode === 38) {
					player2.setAttribute('y', +player2.getAttribute('y') - 20);
				} else if (event.keyCode === 40) {
					player2.setAttribute('y', +player2.getAttribute('y') + 20);
				} else if (event.keyCode === 32) {
					ballMove();
					setInterval(movePlayer1, Math.random() * 2000);
				}
			}

			let direction = 'right';
			let yOffset = Math.random() * 10 - 5;

			function resetBall() {
				ball.setAttribute('x', 395);
				ball.setAttribute('y', 295);
			}

			function ballMove() {
				const currentX = +ball.getAttribute('x');
				const currentY = +ball.getAttribute('y');
				const player2X = +player2.getAttribute('x');
				const player2Y = +player2.getAttribute('y');
				if (currentX + 10 >= player2X && player2Y <= currentY && currentY <= player2Y + 50) {
					direction = 'left';
					setMyScore(myScore + 1);
				}
				if (currentX + 10 >= 800) {
					setComputerScore(computerScore + 1);
					setTimeout(resetBall, 100);
				}
				if (currentX <= +player1.getAttribute('x') + 10) {
					direction = 'right';
				}

				if (currentY <= 10 || currentY >= 590) {
					yOffset = -1 * yOffset;
				}

				ball.setAttribute('y', currentY + yOffset);
				if (direction === 'left') {
					ball.setAttribute('x', currentX - 1);
				} else {
					ball.setAttribute('x', currentX + 1);
				}
				requestAnimationFrame(ballMove);
			}

			document.addEventListener('keydown', movePlayer2);
		</script>
	</body>
</html>
